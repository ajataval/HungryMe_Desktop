<!DOCTYPE html>
<html>
<head>
	<title>Hotel Menu Update Page</title>
	<link rel="stylesheet" href="stylesheets/visuals2.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

	<script>
		var orlen;
		var jobj;
		var user;
        var counter = 0;
        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for(var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }
        function checkCookie() {
            user=getCookie("username");
            if (user != "") {
                //alert("Welcome again " + user);
                $.ajax({
                    type: "GET",
                    url: "/hotel/users/"+user+"/menu",
                    contentType: "application/json"
                }).done(function (obj) {
                    jobj=obj;
                    //find length of menu array inside object 'l'
					orlen = obj.menu.length;
					var link=document.getElementById("aai");
					for(var temp = 1; temp <= orlen; temp++){
					    link.click();
                        $('#mi'+temp).val(obj.menu[temp-1].name);
                        $('#d'+temp).val(obj.menu[temp-1].description);

					}
                }).fail(function (obj) {
                    alert("Failed");
                });
            } else {
                user = prompt("Please enter your name:","");
                if (user != "" && user != null) {
                    setCookie("username", user, 30);
                }
            }
        }

        jQuery(function(){
            jQuery('a.add-item').click(function(event){
                event.preventDefault();
                counter++;
                var newRow = jQuery('<tr><td><input type="text" id="mi' +
                    counter + '"/></td><td><input type="text" id="d' +
                    counter + '"/></td></tr>');

                jQuery('table.menu-list').append(newRow);
            });
        });

        jQuery(function(){
            jQuery('a.updatemenu').click(function(event){
                event.preventDefault();
                for(var x = orlen+1; x <= counter; x++){
					jobj['menu'].push({"name" : $('#mi'+x).val(), "description" : $('#d'+x).val()});
				}
                var t=JSON.stringify(jobj);

				$.ajax({
                    type: "PUT",
                    url: "/hotel/users/"+user+"/menu",
                    data: t,
                    contentType: "application/json"
                }).done(function (obj) {
                    if(obj.result == true)
                        alert("Success");
                    else
                        alert("Failure");
                }).fail(function (obj) {
                    alert("Failed");
                });
            });
        });

        $(function(){
            $('#uploadBTN').on('click', function(){
                var fd = new FormData($("#menuexcel"));
                $.ajax({
                    url: "/hotel/users/"+user+"/uploadMenu",
                    type: 'POST',
                    data: fd,
                    success:function(data){
                        alert("success");
                    },
                    cache: false,
                    contentType: false,
                    processData: false
                });
            });
        });

	</script>
</head>
<style>
	.inv {
		display: none;
	}
</style>
<body onload="checkCookie()">
<div class="banner">
	<img class ="picstyle" src="images/banner4.png" >
</div>
<br/>
<p class = "genwebsitetext">Update Restaurant menu</p>
<br/>
<div class="additemform">
	<p></p>
	<p>Please Select what you would like to do</p>
	<select id="target">
		<option value="">Select...</option>
		<option value="content_1">Upload Excel Sheet</option>
		<option value="content_2">Add Menu Item</option>
		<select>

			<br/><br/><br/>
			<!-- Content 1 Start -->


			<div id="content_1" class="inv">
				<form class="additemform" id="fileinfo" name="fileinfo">
					<div class = "uef">
						<p> Upload Excel File </p>
						<form class="additemform">
							<input type = "file" name ="menuexcel" id="menuexcel">
							<button class="additembutton" id="uploadBTN">Upload Excel</button>
						</form>
						<br/>
					</div>
				</form>

			</div>
			<!-- Content 1 End-->

			<!-- Content 2 Start -->
			<div id="content_2" class="inv">
				<form class="additemform">
					<table id = "itemtable" class="menu-list">
						
						<tr>
							<td>Menu Item</td><td>Description</td>
						</tr>
					</table>
					<table>
						<tr><td><a href="#" title="" class="add-item" id="aai">Add Another Item</a></td>
						</tr>
						<tr><td><a href="#" title="" class="updatemenu" id="mub">Update Menu</a></td>
						</tr>
					</table>

				</form>

			</div>
			<!-- Content 2 End-->

			<!-- Content 3 Start
			<div id="content_3" class="inv">
				<form class="additemform">
					<table id = "itemtable" >
						<tr class = "tableheading">
							<th>Menu Item ID</th>
						</tr>
						<tr>
							<td><input type = "text"></td>
						</tr>
						<tr><td></td></tr>
						<tr>
							<td></td>
							<td><button class="additembutton">Delete Item</button></td>
						</tr>
					</table>
				</form>

			</div>
			 Content 3 End-->
			<script>
                document
                    .getElementById('target')
                    .addEventListener('change', function () {
                        'use strict';
                        var vis = document.querySelector('.vis'),
                            target = document.getElementById(this.value);
                        if (vis !== null) {
                            vis.className = 'inv';
                        }
                        if (target !== null ) {
                            target.className = 'vis';
                        }
                    });
			</script>
</body>
</html>