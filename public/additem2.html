<!DOCTYPE html>
<html>
<head>
	<title>Hotel Menu Update Page</title>
	<link rel="stylesheet" href="stylesheets/visuals2.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
		  integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<link rel="stylesheet" href="stylesheets/visuals2.css"/>
	<script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>
	<script type="text/javascript" src="/bower_components/js-cookie/src/js.cookie.js"></script>
	<script type="text/javascript" src="/bower_components/moment/min/moment.min.js"></script>
	<script type="text/javascript" src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css" />
	<script type="text/javascript" src="/javascripts/validateLogin.js"></script>

	<script>
		var orlen;
		var jobj;
		var user;
        var counter = 0;
        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for(var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }
        function checkCookie() {
            user=getCookie("username");
            if (user != "") {
                $.ajax({
                    type: "GET",
                    url: "/hotel/users/"+user+"/menu",
                    contentType: "application/json"
                }).done(function (obj) {
                    jobj=obj;
                    //find length of menu array inside object 'l'
					orlen = obj.menu.length;
					var link=document.getElementById("aai");
					for(var temp = 1; temp <= orlen; temp++){
					    link.click();
                        $('#mi'+temp).val(obj.menu[temp-1].name);
                        $('#d'+temp).val(obj.menu[temp-1].description);

					}
                }).fail(function (obj) {
                    alert("Failed");
                });
            } else {
                user = prompt("Please enter your name:","");
                if (user != "" && user != null) {
                    setCookie("username", user, 30);
                }
            }
        }

        jQuery(function(){
            jQuery('button.add-item').click(function(event){
                event.preventDefault();
                counter++;
                var newRow = jQuery('<tr><td><input type="text" id="mi' +
                    counter + '"/></td><td><input type="text" id="d' +
                    counter + '"/></td></tr>');

                jQuery('table.menu-list').append(newRow);
            });
        });

        jQuery(function(){
            jQuery('button.updatemenu').click(function(event){
                event.preventDefault();
                for(var x = orlen+1; x <= counter; x++){
                    if($('#mi'+x).val() !="")
					jobj['menu'].push({"name" : $('#mi'+x).val(), "description" : $('#d'+x).val()});
				}
                var t=JSON.stringify(jobj);

				$.ajax({
                    type: "PUT",
                    url: "/hotel/users/"+user+"/menu",
                    data: t,
                    contentType: "application/json"
                }).done(function (obj) {
                    if(obj.result == true)
                        alert("Success");
                    else
                        alert("Failure");
                }).fail(function (obj) {
                    alert("Failed");
                });
            });
        });

        jQuery(function(){
            jQuery('#uploadfile').click(function(event){

                $("#uploadForm").attr("action", "/hotel/users/" + user + "/uploadMenu");
            });
        });

	</script>
</head>
<style>
	.inv {
		display: none;
	}
</style>
<body onload="checkCookie()">
<div class="banner">
		<img class ="picstyle" src="../images/banner4.png" id="home">
		<img class ="picstyle2" id = "logout" src="../images/logout.png" >
</div>
<br/>
<p class = "genwebsitetext">Update Restaurant menu</p>
<br/>
<div class="additemform2">
	<p></p>
	<p class="dropdown">Please Select what you would like to do</p>
	<select class="dropdown" id="target">
		<option value="">Select...</option>
		<option value="content_1">Upload Excel Sheet</option>
		<option value="content_2">Add Menu Item</option>
		<select>

			<br/><br/><br/>
			<!-- Content 1 Start -->
			<div id="content_1" class="inv">
			<form ref='uploadForm'
				  id='uploadForm'
				  action='/hotel/users/hussain0306/uploadMenu'
				  method='POST'
				  encType="multipart/form-data">
				<div class="row">
				<div class="form-group col-sm-offset-3 col-sm-6">
					<!--<input type="file" name="menufile" class="form-control"/>-->
					<label class="custom-file">
						<input type="file" name="menufile" class="custom-file-input">
						<span class="custom-file-control"></span>
					</label>
				</div>
				</div>
				<div class="row">
				<div class="form-group">
					<input type='submit' value='Upload!'  id="uploadfile" class="btn btn-success"/>
				</div>
				</div>
			</form>
			</div>
			<!-- Content 1 End-->

			<!-- Content 2 Start -->
			<div id="content_2" class="inv">
				<form class="additemform">
					<table id = "itemtable" class="menu-list">
						
						<tr>
							<td>Menu Item</td><td>Description</td>
						</tr>
					</table>
					<table class="buttonsmenu">
						<tr><td><button title="" class="add-item" id="aai">Add Another Item</button></td>
						</tr>
						<tr><td><button title="" class="updatemenu" id="mub">Update Menu</button></td>
						</tr>
					</table>

				</form>

			</div>
			<!-- Content 2 End-->

			<script>
                document
                    .getElementById('target')
                    .addEventListener('change', function () {
                        'use strict';
                        var vis = document.querySelector('.vis'),
                            target = document.getElementById(this.value);
                        if (vis !== null) {
                            vis.className = 'inv';
                        }
                        if (target !== null ) {
                            target.className = 'vis';
                        }
                    });
			</script>
</body>
</html>